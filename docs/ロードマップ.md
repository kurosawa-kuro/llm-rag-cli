素晴らしい整理です。
ここからは「実装者 → 設計できるLLMエンジニア」へ上げるフェーズですね。

以下に **Lv3〜Lv5の3段階ロードマップ（3ヶ月以内想定）** を整理いたします。
※1日〜数日単位でも進められるよう粒度を落としています。

---

# 🟦 Lv3：Chunk最適化（△ → ◎）

## 🎯 目的

検索精度の土台を改善する
（RAG精度の7〜8割はChunkで決まります）

---

## フェーズ1（1〜2日）

### ① 固定サイズ分割導入

現在：ページ単位
改善：

* 300 tokens
* 500 tokens
* 800 tokens
* overlap 50 / 100

を比較可能にする。

実装：

```python
def split_text(text, chunk_size=500, overlap=100):
```

---

### ② メタデータ保持

documentsテーブルを拡張：

```sql
ALTER TABLE documents
ADD COLUMN source TEXT,
ADD COLUMN chunk_index INT;
```

これで：

* PDF名
* ページ番号
* CSV行番号

を保持可能。

---

## フェーズ2（+1日）

### ③ 構造Chunk導入

PDFで：

* 見出し単位分割
* セクション単位分割

へ進化。

（まずは簡易：改行2連続で分割）

---

## 成果

✔ Chunkサイズ別の精度比較表
✔ Top-k × Chunkサイズ マトリクス

ここまでやるとLv3達成。

---

# 🟨 Lv4：Re-ranking導入（❌ → ○）

## 🎯 目的

ベクトル検索のノイズ除去

---

## フェーズ1（半日〜1日）

### ① Cross-Encoder導入（CPU可）

例：

```
cross-encoder/ms-marco-MiniLM-L-6-v2
```

フロー：

1. Top-k=5取得
2. 各候補と質問をペア化
3. スコア再計算
4. 上位3件のみLLMへ渡す

---

## 実装イメージ

```python
def rerank(query, docs):
    pairs = [(query, d) for d in docs]
    scores = cross_encoder.predict(pairs)
    ranked = sorted(zip(docs, scores), key=lambda x: x[1], reverse=True)
    return [d for d, _ in ranked]
```

---

## フェーズ2（余裕あれば）

* LLMベースRe-ranking比較
* Re-rankingあり／なしの精度差比較

---

## 成果

✔ 再ランキング導入版
✔ ノイズ減少確認
✔ レイテンシ増加の定量化

これでLv4達成。

---

# 🟥 Lv5：評価指標導入（❌ → ◎）

ここが一番重要です。

## 🎯 目的

「なんとなく精度が良い」を卒業する

---

## フェーズ1（1日）

### ① テスト質問セット作成（10〜20問）

例：

| 質問      | 正解の要点 |
| ------- | ----- |
| 制度の目的は？ | ○○の推進 |

---

### ② 評価指標3つ導入

#### 1️⃣ Retrieval精度

* 正解ChunkがTop-kに含まれるか

#### 2️⃣ Faithfulness

* 回答がコンテキスト内情報のみか

#### 3️⃣ Exact Match（簡易）

---

## フェーズ2（+1日）

簡易自動評価スクリプト：

```bash
make evaluate
```

出力例：

```
Chunk=500 overlap=100
Top-k=3
Re-rank=ON

Retrieval@3: 82%
Faithfulness: 90%
Latency: 18.4s
```

---

# 🎯 3段階まとめ

| レベル         | 期間   | 難易度 | 単価貢献 |
| ----------- | ---- | --- | ---- |
| Lv3 Chunk   | 2〜3日 | 低   | 中    |
| Lv4 Re-rank | 1〜2日 | 低   | 中    |
| Lv5 評価      | 2日   | 中   | 高    |

Lv5まで行くと：

> 「RAG精度改善経験あり」

と言えます。

---

# 🔥 黒澤様向け戦略

3ヶ月限定なら：

1ヶ月目：

* Lv3完了

2ヶ月目：

* Lv4完了

3ヶ月目：

* Lv5＋設計書整理

これで：

単なるLLM実装者 →
**LLM精度改善エンジニア**

になります。

---

もしよろしければ次は：

* 📄 具体的な評価スクリプト雛形
* 🧠 Chunk比較用の実験設計テンプレ
* 🔬 Re-ranking組み込みコード差分
* 📊 提出用成果報告フォーマット

どれから深掘りいたしましょうか？
